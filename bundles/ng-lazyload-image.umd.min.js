!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","@angular/core","rxjs","rxjs/operators"],t):t(e["ng-lazyload-image"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,o,s,i){"use strict";var a="ng-lazyloaded",u="ng-failed-lazyloaded";function c(e,t){e.className.includes(t)||(e.className+=" "+t)}function l(){return"undefined"!=typeof window}function f(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function p(e){return"img"===e.nodeName.toLowerCase()}function m(e,t,n){return p(e)?n?e.srcset=t:e.src=t:e.style.backgroundImage="url('"+t+"')",e}function t(o){return function(e){for(var t=e.parentElement.getElementsByTagName("source"),n=0;n<t.length;n++){var r=t[n].getAttribute(o);r&&(t[n].srcset=r)}}}var n=t("defaultImage"),g=t("lazyLoad"),r=t("errorImage");function h(r){return function(e,t,n){p(e)&&f(e)&&r(e),t&&m(e,t,n)}}var d=h(n),b=h(g),v=h(r),y={"finally":function(e){return c(e.element,a)},loadImage:function(e){var n,t=e.element,r=e.useSrcset,o=e.imagePath;if(p(t)&&f(t)){var i=t.parentNode.cloneNode(!0);n=i.getElementsByTagName("img")[0],g(n),m(n,o,r)}else n=new Image,p(t)&&t.sizes&&(n.sizes=t.sizes),r?n.srcset=o:n.src=o;return s.Observable.create(function(t){n.onload=function(){t.next(o),t.complete()},n.onerror=function(e){t.error(null)}})},setErrorImage:function(e){var t=e.element,n=e.errorImagePath,r=e.useSrcset;v(t,n,r),c(t,u)},setLoadedImage:function(e){var t=e.element,n=e.imagePath,r=e.useSrcset;b(t,n,r)},setup:function(e){var t=e.element,n=e.defaultImagePath,r=e.useSrcset;d(t,n,r),function o(e,t){return e.className&&e.className.includes(t)}(t,a)&&function i(e,t){e.className=e.className.replace(t,"")}(t,a)}},I=(O.fromElement=function(e){var t=e.getBoundingClientRect(),n=t.left,r=t.top,o=t.right,i=t.bottom;return 0===n&&0===r&&0===o&&0===i?O.empty:new O(n,r,o,i)},O.fromWindow=function(e){return new O(0,0,e.innerWidth,e.innerHeight)},O.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},O.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},O.prototype.getIntersectionWith=function(e){var t=Math.max(this.left,e.left),n=Math.max(this.top,e.top),r=Math.min(this.right,e.right),o=Math.min(this.bottom,e.bottom);return t<=r&&n<=o?new O(t,n,r,o):O.empty},O.empty=new O(0,0,0,0),O);function O(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}var w=new WeakMap;function E(r){if(!r||"function"!=typeof r.addEventListener)return l()&&console.warn("`addEventListener` on "+r+" (scrollTarget) is not a function. Skipping this target"),s.empty();if(w.has(r))return w.get(r);var e=function n(e,t){return e.pipe(i.sampleTime(100,t),i.share(),i.startWith(""))}(s.Observable.create(function(t){function e(e){return t.next(e)}var n={passive:!0,capture:!1};return r.addEventListener("scroll",e,n),function(){return r.removeEventListener("scroll",e,n)}}));return w.set(r,e),e}var L=Object.assign({},y,{isVisible:function(e,t){var n=e.element,r=e.offset,o=e.scrollContainer;void 0===t&&(t=function(){return window});var i=I.fromElement(n);if(i===I.empty)return!1;var s=I.fromWindow(t());if(i.inflate(r),o){var a=I.fromElement(o).getIntersectionWith(s);return i.intersectsWith(a)}return i.intersectsWith(s)},getObservable:function(e){return e.scrollObservable?e.scrollObservable.pipe(i.startWith("")):e.scrollContainer?E(e.scrollContainer):E(l()?window:undefined)}});var x=(C.prototype.ngOnChanges=function(){this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:0|this.offset,scrollContainer:this.scrollTarget,scrollObservable:this.scrollObservable})},C.prototype.ngAfterContentInit=function(){var t=this;if(!l())return null;this.ngZone.runOutsideAngular(function(){t.scrollSubscription=t.propertyChanges$.pipe(i.tap(function(e){return t.hooks.setup(e)}),i.switchMap(function(e){return t.hooks.getObservable(e).pipe(function r(t,n){return function(e){return e.pipe(i.filter(function(e){return t.isVisible({element:n.element,event:e,offset:n.offset,scrollContainer:n.scrollContainer})}),i.take(1),i.mergeMap(function(){return t.loadImage(n)}),i.tap(function(e){return t.setLoadedImage({element:n.element,imagePath:e,useSrcset:n.useSrcset})}),i.map(function(){return!0}),i.catchError(function(){return t.setErrorImage(n),s.of(!1)}),i.tap(function(){return t["finally"](n)}))}}(t.hooks,e))})).subscribe(function(e){return t.onLoad.emit({element:t.elementRef,success:e})})})},C.prototype.ngOnDestroy=function(){[this.scrollSubscription].filter(function(e){return e&&!e.isUnsubscribed}).forEach(function(e){return e.unsubscribe()})},C.decorators=[{type:o.Directive,args:[{selector:"[lazyLoad]"}]}],C.ctorParameters=function(){return[{type:o.ElementRef},{type:o.NgZone},{type:undefined,decorators:[{type:o.Optional},{type:o.Inject,args:["options"]}]}]},C.propDecorators={lazyImage:[{type:o.Input,args:["lazyLoad"]}],defaultImage:[{type:o.Input}],errorImage:[{type:o.Input}],scrollTarget:[{type:o.Input}],scrollObservable:[{type:o.Input}],offset:[{type:o.Input}],useSrcset:[{type:o.Input}],onLoad:[{type:o.Output}]},C);function C(e,t,n){this.onLoad=new o.EventEmitter,this.elementRef=e,this.ngZone=t,this.propertyChanges$=new s.ReplaySubject,this.hooks=function r(t){if(!t)return L;var n={};return t.preset?Object.assign(n,t.preset):Object.assign(n,L),Object.keys(t).filter(function(e){return"preset"!==e}).forEach(function(e){n[e]=t[e]}),n}(n)}var j=(z.forRoot=function(e){return{ngModule:z,providers:[{provide:"options",useValue:e}]}},z.decorators=[{type:o.NgModule,args:[{declarations:[x],exports:[x]}]}],z);function z(){}var N=new WeakMap,S=new s.Subject;function M(e){e.forEach(function(e){return S.next(e)})}function P(n){if(!n.scrollContainer&&!l())return s.empty();var e={root:n.scrollContainer};n.offset&&(e.rootMargin=n.offset+"px");var t=n.scrollContainer||window,r=N.get(t);return r||(r=new IntersectionObserver(M,e),N.set(t,r)),r.observe(n.element),s.Observable.create(function(e){var t=S.pipe(i.filter(function(e){return e.target===n.element})).subscribe(e);return function(){t.unsubscribe(),r.unobserve(n.element)}})}var W=Object.assign({},y,{isVisible:function(e){return e.event.isIntersecting},getObservable:function(e,t){return void 0===t&&(t=P),e.scrollObservable?e.scrollObservable:t(e)}});e.LazyLoadImageDirective=x,e.LazyLoadImageModule=j,e.intersectionObserverPreset=W,e.scrollPreset=L,e["default"]=j,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map